import{s as te,j as me,u as ve,k as be,l as ge,r as ke,c as ye,o as Q,b as W,n as B,d as ce}from"../chunks/scheduler.BWOwpdHh.js";import{S as se,i as le,e as k,s as O,x as K,c as y,a as P,d as v,m as q,b as T,A as G,t as V,f as N,k as ne,o as re,C as J,w as _,q as C,r as Ce,n as z,g as Z,h as x,j as oe,l as ae,p as ie,u as ue}from"../chunks/index.MrXRJrN0.js";import{u as ee,s as X,a as fe,r as pe}from"../chunks/stores.C_hhX81d.js";import{P as we}from"../chunks/PartialUser.0Mh093ly.js";import{g as $e}from"../chunks/_commonjsHelpers.Cpj98o6Y.js";import{r as Le}from"../chunks/purify.Cr2W7fZ8.js";const Ee=!1,Ke=Object.freeze(Object.defineProperty({__proto__:null,ssr:Ee},Symbol.toStringTag,{value:"Module"}));function de(r){let e,t;return{c(){e=k("div"),t=ne(r[0]),this.h()},l(s){e=y(s,"DIV",{style:!0,class:!0});var l=P(e);t=re(l,r[0]),l.forEach(v),this.h()},h(){J(e,"top",r[3]+"px"),J(e,"left",r[2]+"px"),_(e,"class","tooltip svelte-4dwvi9")},m(s,l){T(s,e,l),C(e,t)},p(s,l){l&1&&Ce(t,s[0]),l&8&&J(e,"top",s[3]+"px"),l&4&&J(e,"left",s[2]+"px")},d(s){s&&v(e)}}}function Te(r){let e,t,s,l,a,h;const c=r[8].default,o=me(c,r,r[7],null);let n=r[1]&&de(r);return{c(){e=k("div"),o&&o.c(),t=O(),n&&n.c(),s=K()},l(i){e=y(i,"DIV",{});var u=P(e);o&&o.l(u),u.forEach(v),t=q(i),n&&n.l(i),s=K()},m(i,u){T(i,e,u),o&&o.m(e,null),T(i,t,u),n&&n.m(i,u),T(i,s,u),l=!0,a||(h=[G(e,"mouseover",r[4]),G(e,"mouseleave",r[6]),G(e,"mousemove",r[5])],a=!0)},p(i,[u]){o&&o.p&&(!l||u&128)&&ve(o,c,i,i[7],l?ge(c,i[7],u,null):be(i[7]),null),i[1]?n?n.p(i,u):(n=de(i),n.c(),n.m(s.parentNode,s)):n&&(n.d(1),n=null)},i(i){l||(V(o,i),l=!0)},o(i){N(o,i),l=!1},d(i){i&&(v(e),v(t),v(s)),o&&o.d(i),n&&n.d(i),a=!1,ke(h)}}}function Me(r,e,t){let{$$slots:s={},$$scope:l}=e,{title:a=""}=e,h=!1,c,o;function n(f){t(1,h=!0),t(2,c=f.pageX-100),t(3,o=f.pageY+5)}function i(f){t(2,c=f.pageX-100),t(3,o=f.pageY+5)}function u(){t(1,h=!1)}return r.$$set=f=>{"title"in f&&t(0,a=f.title),"$$scope"in f&&t(7,l=f.$$scope)},[a,h,c,o,n,i,u,l,s]}class Ie extends se{constructor(e){super(),le(this,e,Me,Te,te,{title:0})}}var De=Le();const _e=$e(De);function Se(r){let e,t="Couldn't find user, make sure the username is not misspelled";return{c(){e=k("p"),e.textContent=t},l(s){e=y(s,"P",{"data-svelte-h":!0}),z(e)!=="svelte-1rmwtf3"&&(e.textContent=t)},m(s,l){T(s,e,l)},p:B,i:B,o:B,d(s){s&&v(e)}}}function Ae(r){let e,t;return e=new we({props:{user:r[0],$$slots:{default:[He]},$$scope:{ctx:r}}}),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,l){ie(e,s,l),t=!0},p(s,l){const a={};l&1&&(a.user=s[0]),l&131073&&(a.$$scope={dirty:l,ctx:s}),e.$set(a)},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){ue(e,s)}}}function He(r){let e,t=r[0].online?"Online":"Offline",s;return{c(){e=k("p"),s=ne(t)},l(l){e=y(l,"P",{});var a=P(e);s=re(a,t),a.forEach(v)},m(l,a){T(l,e,a),C(e,s)},p(l,a){a&1&&t!==(t=l[0].online?"Online":"Offline")&&Ce(s,t)},d(l){l&&v(e)}}}function Oe(r){let e,t,s="",l,a,h;return{c(){e=k("button"),t=k("span"),l=ne(s),this.h()},l(c){e=y(c,"BUTTON",{class:!0});var o=P(e);t=y(o,"SPAN",{class:!0}),P(t).forEach(v),l=re(o,s),o.forEach(v),this.h()},h(){_(t,"class","fa fa-envelope"),_(e,"class","btn svelte-1fno66w")},m(c,o){T(c,e,o),C(e,t),C(e,l),a||(h=G(e,"click",r[13]),a=!0)},p:B,d(c){c&&v(e),a=!1,h()}}}function Pe(r){let e,t='<span class="fa fa-envelope-open"></span>',s,l;return{c(){e=k("button"),e.innerHTML=t,this.h()},l(a){e=y(a,"BUTTON",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-1obrngw"&&(e.innerHTML=t),this.h()},h(){_(e,"class","btn svelte-1fno66w")},m(a,h){T(a,e,h),s||(l=G(e,"click",r[12]),s=!0)},p:B,d(a){a&&v(e),s=!1,l()}}}function qe(r){let e,t,s,l,a,h,c,o,n,i,u,f,b,A,E,M="Send",H,R,D,d,w;const L=[Ae,Se],m=[];function p($,S){return S&4&&(h=null),$[0]?0:(h==null&&(h=!!($[2]&&$[2].value.replaceAll(" ","")!=="")),h?1:-1)}~(c=p(r,-1))&&(o=m[c]=L[c](r));function g($,S){return $[3]?Pe:Oe}let I=g(r),U=I(r);return{c(){e=k("div"),t=k("div"),s=k("div"),l=k("input"),a=O(),o&&o.c(),n=O(),i=k("div"),u=O(),f=k("div"),b=k("input"),A=O(),E=k("button"),E.textContent=M,R=O(),U.c(),this.h()},l($){e=y($,"DIV",{class:!0});var S=P(e);t=y(S,"DIV",{class:!0,style:!0});var j=P(t);s=y(j,"DIV",{class:!0});var Y=P(s);l=y(Y,"INPUT",{type:!0,class:!0,placeholder:!0}),a=q(Y),o&&o.l(Y),Y.forEach(v),n=q(j),i=y(j,"DIV",{class:!0}),P(i).forEach(v),u=q(j),f=y(j,"DIV",{class:!0});var F=P(f);b=y(F,"INPUT",{type:!0,class:!0,placeholder:!0}),A=q(F),E=y(F,"BUTTON",{class:!0,"data-svelte-h":!0}),z(E)!=="svelte-sxy7mc"&&(E.textContent=M),F.forEach(v),j.forEach(v),R=q(S),U.l(S),S.forEach(v),this.h()},h(){_(l,"type","text"),_(l,"class","search-user svelte-1fno66w"),_(l,"placeholder","User to DM"),_(s,"class","user-searching"),_(i,"class","messages svelte-1fno66w"),_(b,"type","text"),_(b,"class","content svelte-1fno66w"),_(b,"placeholder","enter a message..."),_(E,"class","send"),_(f,"class","messaging-div svelte-1fno66w"),_(t,"class","chatbox svelte-1fno66w"),_(t,"style",H=`display: ${r[3]?"block":"none"}`),_(e,"class","chatbox-and-icon svelte-1fno66w")},m($,S){T($,e,S),C(e,t),C(t,s),C(s,l),r[8](l),C(s,a),~c&&m[c].m(s,null),C(t,n),C(t,i),r[9](i),C(t,u),C(t,f),C(f,b),r[10](b),C(f,A),C(f,E),r[11](t),C(e,R),U.m(e,null),D=!0,d||(w=[G(l,"input",r[6]),G(E,"click",r[7])],d=!0)},p($,[S]){let j=c;c=p($,S),c===j?~c&&m[c].p($,S):(o&&(Z(),N(m[j],1,1,()=>{m[j]=null}),x()),~c?(o=m[c],o?o.p($,S):(o=m[c]=L[c]($),o.c()),V(o,1),o.m(s,null)):o=null),(!D||S&8&&H!==(H=`display: ${$[3]?"block":"none"}`))&&_(t,"style",H),I===(I=g($))&&U?U.p($,S):(U.d(1),U=I($),U&&(U.c(),U.m(e,null)))},i($){D||(V(o),D=!0)},o($){N(o),D=!1},d($){$&&v(e),r[8](null),~c&&m[c].d(),r[9](null),r[10](null),r[11](null),U.d(),d=!1,ke(w)}}}function Ve(r,e,t){let s;ye(r,ee,d=>t(14,s=d));let l=null,a,h,c=!1,o,n;function i(d){d.target.value===""&&t(0,l=null),fe.get(`${pe}/users/@${d.target.value}`).then(w=>{t(0,l=w.data)}).catch(console.log)}Q(()=>{t(4,o=document.querySelector(".content")),a.addEventListener("keypress",d=>{d.key==="Enter"&&u()})});function u(d){let w=o.value;w=_e.sanitize(w),w.replaceAll(" ","")!==""&&X.emit("message",w,l)}Q(()=>{t(5,n.innerHTML="",n),X.emit("get_messages",async d=>{if(n.innerHTML===""){for(let w of d)await b(w.username,w.content);n.scrollTo(0,n.scrollHeight)}}),X.on("message",async d=>{await b(d.username,d.content),n.scrollTo(0,n.scrollHeight)})});async function f(d){var w=/\B@\w+/g,L=[...d.matchAll(w)];let m=d;for(let p of L){let g=p[0];try{let I=await fe.get(`${pe}/users/${g}`);m=m.replace(g,`<a href="/profile/@${I.data.username}">@${I.data.username}</a>`)}catch(I){console.log(I)}}return m}async function b(d,w,L){if(n&&o){let m=document.createElement("p");w=await f(w);let p=`<b>${L?"[DM] ":""}${d}</b>: ${w}`;m.innerHTML=_e.sanitize(p,{ALLOWED_TAGS:["b","a","br","p"]}),n.appendChild(m),n.scrollTo(0,n.scrollHeight),d===s.username&&t(4,o.value="",o)}}function A(d){W[d?"unshift":"push"](()=>{h=d,t(2,h)})}function E(d){W[d?"unshift":"push"](()=>{n=d,t(5,n)})}function M(d){W[d?"unshift":"push"](()=>{o=d,t(4,o)})}function H(d){W[d?"unshift":"push"](()=>{a=d,t(1,a)})}return[l,a,h,c,o,n,i,u,A,E,M,H,()=>{t(3,c=!1)},()=>{t(3,c=!0)}]}class Ue extends se{constructor(e){super(),le(this,e,Ve,qe,te,{})}}function Ne(r){let e,t="Disconnect",s,l,a="Create",h,c,o;return c=new Ie({props:{title:`${r[0].username}`,$$slots:{default:[ze]},$$scope:{ctx:r}}}),{c(){e=k("a"),e.textContent=t,s=O(),l=k("a"),l.textContent=a,h=O(),oe(c.$$.fragment),this.h()},l(n){e=y(n,"A",{href:!0,class:!0,"data-svelte-h":!0}),z(e)!=="svelte-1lsbkpz"&&(e.textContent=t),s=q(n),l=y(n,"A",{href:!0,class:!0,"data-svelte-h":!0}),z(l)!=="svelte-13h8egb"&&(l.textContent=a),h=q(n),ae(c.$$.fragment,n),this.h()},h(){_(e,"href","/disconnect"),_(e,"class","svelte-7ue247"),_(l,"href","/create"),_(l,"class","svelte-7ue247")},m(n,i){T(n,e,i),T(n,s,i),T(n,l,i),T(n,h,i),ie(c,n,i),o=!0},p(n,i){const u={};i&1&&(u.title=`${n[0].username}`),i&5&&(u.$$scope={dirty:i,ctx:n}),c.$set(u)},i(n){o||(V(c.$$.fragment,n),o=!0)},o(n){N(c.$$.fragment,n),o=!1},d(n){n&&(v(e),v(s),v(l),v(h)),ue(c,n)}}}function je(r){let e,t="Login";return{c(){e=k("a"),e.textContent=t,this.h()},l(s){e=y(s,"A",{href:!0,class:!0,"data-svelte-h":!0}),z(e)!=="svelte-1vxwqu1"&&(e.textContent=t),this.h()},h(){_(e,"href","/login"),_(e,"class","svelte-7ue247")},m(s,l){T(s,e,l)},p:B,i:B,o:B,d(s){s&&v(e)}}}function ze(r){let e,t,s;return{c(){e=k("a"),t=k("img"),this.h()},l(l){e=y(l,"A",{href:!0,class:!0});var a=P(e);t=y(a,"IMG",{src:!0,alt:!0,class:!0}),a.forEach(v),this.h()},h(){ce(t.src,s=r[0].avatar)||_(t,"src",s),_(t,"alt","Profile"),_(t,"class","svelte-7ue247"),_(e,"href","/profile"),_(e,"class","svelte-7ue247")},m(l,a){T(l,e,a),C(e,t)},p(l,a){a&1&&!ce(t.src,s=l[0].avatar)&&_(t,"src",s)},d(l){l&&v(e)}}}function he(r){let e,t;return e=new Ue({}),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,l){ie(e,s,l),t=!0},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){ue(e,s)}}}function Be(r){let e,t,s='<h1 class="svelte-7ue247">Persona</h1>',l,a,h='<a href="/discover" class="svelte-7ue247">Discover</a>',c,o,n='<input type="text" class="searchbar svelte-7ue247" placeholder="Search something..."/> <button class="searchbtn">Search!</button>',i,u,f,b,A,E,M,H;const R=[je,Ne],D=[];function d(p,g){return p[0]?1:0}f=d(r),b=D[f]=R[f](r);const w=r[1].default,L=me(w,r,r[2],null);let m=r[0]&&he();return{c(){e=k("nav"),t=k("a"),t.innerHTML=s,l=O(),a=k("div"),a.innerHTML=h,c=O(),o=k("div"),o.innerHTML=n,i=O(),u=k("div"),b.c(),A=O(),L&&L.c(),E=O(),m&&m.c(),M=K(),this.h()},l(p){e=y(p,"NAV",{class:!0});var g=P(e);t=y(g,"A",{class:!0,href:!0,"data-svelte-h":!0}),z(t)!=="svelte-1lz486n"&&(t.innerHTML=s),l=q(g),a=y(g,"DIV",{class:!0,"data-svelte-h":!0}),z(a)!=="svelte-ix3u3b"&&(a.innerHTML=h),c=q(g),o=y(g,"DIV",{class:!0,"data-svelte-h":!0}),z(o)!=="svelte-vna3yu"&&(o.innerHTML=n),i=q(g),u=y(g,"DIV",{class:!0});var I=P(u);b.l(I),I.forEach(v),g.forEach(v),A=q(p),L&&L.l(p),E=q(p),m&&m.l(p),M=K(),this.h()},h(){_(t,"class","title svelte-7ue247"),_(t,"href","/"),_(a,"class","links"),_(o,"class","searching svelte-7ue247"),_(u,"class","profile-corner svelte-7ue247"),_(e,"class","navbar svelte-7ue247")},m(p,g){T(p,e,g),C(e,t),C(e,l),C(e,a),C(e,c),C(e,o),C(e,i),C(e,u),D[f].m(u,null),T(p,A,g),L&&L.m(p,g),T(p,E,g),m&&m.m(p,g),T(p,M,g),H=!0},p(p,[g]){let I=f;f=d(p),f===I?D[f].p(p,g):(Z(),N(D[I],1,1,()=>{D[I]=null}),x(),b=D[f],b?b.p(p,g):(b=D[f]=R[f](p),b.c()),V(b,1),b.m(u,null)),L&&L.p&&(!H||g&4)&&ve(L,w,p,p[2],H?ge(w,p[2],g,null):be(p[2]),null),p[0]?m?g&1&&V(m,1):(m=he(),m.c(),V(m,1),m.m(M.parentNode,M)):m&&(Z(),N(m,1,1,()=>{m=null}),x())},i(p){H||(V(b),V(L,p),V(m),H=!0)},o(p){N(b),N(L,p),N(m),H=!1},d(p){p&&(v(e),v(A),v(E),v(M)),D[f].d(),L&&L.d(p),m&&m.d(p)}}}function Re(r,e,t){let s;ye(r,ee,h=>t(0,s=h));let{$$slots:l={},$$scope:a}=e;return Q(async()=>{let h=document.querySelectorAll("button");for(let u of h)u.addEventListener("mousedown",f=>{u.classList.add("clicked"),u.addEventListener("mouseleave",b=>{u.classList.remove("clicked")})}),u.addEventListener("mouseup",f=>{u.classList.remove("clicked"),u.addEventListener("mouseenter",b=>{u.classList.add("clicked")})});let c=document.querySelector(".searchbar");document.querySelector(".searchbtn").addEventListener("click",u=>{window.location.href=`/search?q=${encodeURIComponent(c.value)}`});function n(u){let f=u+"=",A=decodeURIComponent(document.cookie).split(";");for(let E=0;E<A.length;E++){let M=A[E];for(;M.charAt(0)==" ";)M=M.substring(1);if(M.indexOf(f)==0)return M.substring(f.length,M.length)}return""}function i(){let u="abcdefghijklmnopqrstuvwxyz1234567890",f="";for(let b=0;b<10;b++)f+=u[Math.floor(Math.random()*u.length)];return f}localStorage.setItem("session",i()),(async()=>n("token")&&(X.connected||(X.connect(),X.emit("session",localStorage.getItem("session"),n("token"),u=>{u&&ee.set(u)}))))()}),r.$$set=h=>{"$$scope"in h&&t(2,a=h.$$scope)},[s,l,a]}class Qe extends se{constructor(e){super(),le(this,e,Re,Be,te,{})}}export{Qe as component,Ke as universal};
