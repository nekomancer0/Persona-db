import{s as se,j as _e,u as he,k as ve,l as ge,r as be,c as ke,o as Z,b as F,n as R,d as fe}from"../chunks/scheduler.BWOwpdHh.js";import{S as le,i as ne,e as y,s as H,x as Q,c as C,a as O,d as g,m as P,b as T,A as G,t as V,f as U,k as re,o as ae,C as W,w as h,q as L,r as ye,n as j,g as x,h as ee,j as oe,l as ie,p as ue,u as ce}from"../chunks/index.MrXRJrN0.js";import{u as te,a as J,r as K,s as Ce}from"../chunks/stores.B2cYib0m.js";import{P as Le}from"../chunks/PartialUser.BxFKzfuP.js";import{g as Ee}from"../chunks/_commonjsHelpers.Cpj98o6Y.js";import{r as $e}from"../chunks/purify.Cr2W7fZ8.js";const Te=!1,Ke=Object.freeze(Object.defineProperty({__proto__:null,ssr:Te},Symbol.toStringTag,{value:"Module"}));function pe(r){let e,t;return{c(){e=y("div"),t=re(r[0]),this.h()},l(s){e=C(s,"DIV",{style:!0,class:!0});var l=O(e);t=ae(l,r[0]),l.forEach(g),this.h()},h(){W(e,"top",r[3]+"px"),W(e,"left",r[2]+"px"),h(e,"class","tooltip svelte-4dwvi9")},m(s,l){T(s,e,l),L(e,t)},p(s,l){l&1&&ye(t,s[0]),l&8&&W(e,"top",s[3]+"px"),l&4&&W(e,"left",s[2]+"px")},d(s){s&&g(e)}}}function Me(r){let e,t,s,l,i,d;const u=r[8].default,a=_e(u,r,r[7],null);let o=r[1]&&pe(r);return{c(){e=y("div"),a&&a.c(),t=H(),o&&o.c(),s=Q()},l(n){e=C(n,"DIV",{});var m=O(e);a&&a.l(m),m.forEach(g),t=P(n),o&&o.l(n),s=Q()},m(n,m){T(n,e,m),a&&a.m(e,null),T(n,t,m),o&&o.m(n,m),T(n,s,m),l=!0,i||(d=[G(e,"mouseover",r[4]),G(e,"mouseleave",r[6]),G(e,"mousemove",r[5])],i=!0)},p(n,[m]){a&&a.p&&(!l||m&128)&&he(a,u,n,n[7],l?ge(u,n[7],m,null):ve(n[7]),null),n[1]?o?o.p(n,m):(o=pe(n),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},i(n){l||(V(a,n),l=!0)},o(n){U(a,n),l=!1},d(n){n&&(g(e),g(t),g(s)),a&&a.d(n),o&&o.d(n),i=!1,be(d)}}}function we(r,e,t){let{$$slots:s={},$$scope:l}=e,{title:i=""}=e,d=!1,u,a;function o(f){t(1,d=!0),t(2,u=f.pageX-100),t(3,a=f.pageY+5)}function n(f){t(2,u=f.pageX-100),t(3,a=f.pageY+5)}function m(){t(1,d=!1)}return r.$$set=f=>{"title"in f&&t(0,i=f.title),"$$scope"in f&&t(7,l=f.$$scope)},[i,d,u,a,o,n,m,l,s]}class Ie extends le{constructor(e){super(),ne(this,e,we,Me,se,{title:0})}}var De=$e();const de=Ee(De);function Ae(r){let e,t="Couldn't find user, make sure the username is not misspelled";return{c(){e=y("p"),e.textContent=t},l(s){e=C(s,"P",{"data-svelte-h":!0}),j(e)!=="svelte-1rmwtf3"&&(e.textContent=t)},m(s,l){T(s,e,l)},p:R,i:R,o:R,d(s){s&&g(e)}}}function Se(r){let e,t;return e=new Le({props:{user:r[0],$$slots:{default:[He]},$$scope:{ctx:r}}}),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){ue(e,s,l),t=!0},p(s,l){const i={};l&1&&(i.user=s[0]),l&262145&&(i.$$scope={dirty:l,ctx:s}),e.$set(i)},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){U(e.$$.fragment,s),t=!1},d(s){ce(e,s)}}}function He(r){let e,t=r[0].online?"Online":"Offline",s;return{c(){e=y("p"),s=re(t)},l(l){e=C(l,"P",{});var i=O(e);s=ae(i,t),i.forEach(g)},m(l,i){T(l,e,i),L(e,s)},p(l,i){i&1&&t!==(t=l[0].online?"Online":"Offline")&&ye(s,t)},d(l){l&&g(e)}}}function Oe(r){let e,t,s="",l,i,d;return{c(){e=y("button"),t=y("span"),l=re(s),this.h()},l(u){e=C(u,"BUTTON",{class:!0});var a=O(e);t=C(a,"SPAN",{class:!0}),O(t).forEach(g),l=ae(a,s),a.forEach(g),this.h()},h(){h(t,"class","fa fa-envelope"),h(e,"class","btn svelte-1g0mprc")},m(u,a){T(u,e,a),L(e,t),L(e,l),i||(d=G(e,"click",r[14]),i=!0)},p:R,d(u){u&&g(e),i=!1,d()}}}function Pe(r){let e,t='<span class="fa fa-envelope-open"></span>',s,l;return{c(){e=y("button"),e.innerHTML=t,this.h()},l(i){e=C(i,"BUTTON",{class:!0,"data-svelte-h":!0}),j(e)!=="svelte-1obrngw"&&(e.innerHTML=t),this.h()},h(){h(e,"class","btn svelte-1g0mprc")},m(i,d){T(i,e,d),s||(l=G(e,"click",r[13]),s=!0)},p:R,d(i){i&&g(e),s=!1,l()}}}function Ve(r){let e,t,s,l,i,d,u,a,o,n,m,f,k,I,E,q="Send",S,z,M,B,p;const v=[Se,Ae],_=[];function c($,D){return D&4&&(d=null),$[0]?0:(d==null&&(d=!!($[2]&&$[2].value.replaceAll(" ","")!=="")),d?1:-1)}~(u=c(r,-1))&&(a=_[u]=v[u](r));function b($,D){return $[3]?Pe:Oe}let A=b(r),w=A(r);return{c(){e=y("div"),t=y("div"),s=y("div"),l=y("input"),i=H(),a&&a.c(),o=H(),n=y("div"),m=H(),f=y("div"),k=y("input"),I=H(),E=y("button"),E.textContent=q,z=H(),w.c(),this.h()},l($){e=C($,"DIV",{class:!0});var D=O(e);t=C(D,"DIV",{class:!0,style:!0});var N=O(t);s=C(N,"DIV",{class:!0});var X=O(s);l=C(X,"INPUT",{type:!0,class:!0,placeholder:!0}),i=P(X),a&&a.l(X),X.forEach(g),o=P(N),n=C(N,"DIV",{class:!0}),O(n).forEach(g),m=P(N),f=C(N,"DIV",{class:!0});var Y=O(f);k=C(Y,"INPUT",{type:!0,class:!0,placeholder:!0}),I=P(Y),E=C(Y,"BUTTON",{class:!0,"data-svelte-h":!0}),j(E)!=="svelte-sxy7mc"&&(E.textContent=q),Y.forEach(g),N.forEach(g),z=P(D),w.l(D),D.forEach(g),this.h()},h(){h(l,"type","text"),h(l,"class","search-user svelte-1g0mprc"),h(l,"placeholder","User to DM"),h(s,"class","user-searching"),h(n,"class","messages svelte-1g0mprc"),h(k,"type","text"),h(k,"class","content svelte-1g0mprc"),h(k,"placeholder","enter a message..."),h(E,"class","send"),h(f,"class","messaging-div svelte-1g0mprc"),h(t,"class","chatbox svelte-1g0mprc"),h(t,"style",S=`display: ${r[3]?"block":"none"}`),h(e,"class","chatbox-and-icon svelte-1g0mprc")},m($,D){T($,e,D),L(e,t),L(t,s),L(s,l),r[9](l),L(s,i),~u&&_[u].m(s,null),L(t,o),L(t,n),r[10](n),L(t,m),L(t,f),L(f,k),r[11](k),L(f,I),L(f,E),r[12](t),L(e,z),w.m(e,null),M=!0,B||(p=[G(l,"input",r[6]),G(E,"click",r[7])],B=!0)},p($,[D]){let N=u;u=c($,D),u===N?~u&&_[u].p($,D):(a&&(x(),U(_[N],1,1,()=>{_[N]=null}),ee()),~u?(a=_[u],a?a.p($,D):(a=_[u]=v[u]($),a.c()),V(a,1),a.m(s,null)):a=null),(!M||D&8&&S!==(S=`display: ${$[3]?"block":"none"}`))&&h(t,"style",S),A===(A=b($))&&w?w.p($,D):(w.d(1),w=A($),w&&(w.c(),w.m(e,null)))},i($){M||(V(a),M=!0)},o($){U(a),M=!1},d($){$&&g(e),r[9](null),~u&&_[u].d(),r[10](null),r[11](null),r[12](null),w.d(),B=!1,be(p)}}}function qe(r,e,t){let s;ke(r,te,p=>t(15,s=p));let{socket:l}=e,i=null,d,u,a=!1,o,n;function m(p){p.target.value===""&&t(0,i=null),J.get(`${K}/users/@${p.target.value}`).then(v=>{t(0,i=v.data)}).catch(console.log)}Z(()=>{t(4,o=document.querySelector(".content")),d.addEventListener("keypress",p=>{p.key==="Enter"&&f()})});function f(p){let v=o.value;v=de.sanitize(v),v.replaceAll(" ","")!==""&&l.emit("message",v,i)}Z(()=>{t(5,n.innerHTML="",n),l.on("retrieve_messages",async p=>{if(n&&o)if(n.innerHTML==="")for(let v of p){let _=await J.get(`${K}/users/${v.userId}`);await I(_.data,v.content)}else{let v=p.at(-1),_=await J.get(`${K}/users/${v.userId}`);await I(_.data,v.content)}})});async function k(p){var v=/\B@\w+/g,_=[...p.matchAll(v)];let c=p;for(let b of _){let A=b[0];try{let w=await J.get(`${K}/users/${A}`);c=c.replace(A,`<a href="/profile/@${w.data.username}">@${w.data.username}</a>`)}catch(w){console.log(w)}}return c}async function I(p,v,_){if(n&&o){let c=document.createElement("p");v=await k(v);let b=`<b>${_?"[DM] ":""}${p.username}</b>: ${v}`;c.innerHTML=de.sanitize(b,{ALLOWED_TAGS:["b","a","br","p"]}),n.appendChild(c),n.scrollTo(0,n.scrollHeight),p.username===s.username&&t(4,o.value="",o)}}function E(p){F[p?"unshift":"push"](()=>{u=p,t(2,u)})}function q(p){F[p?"unshift":"push"](()=>{n=p,t(5,n)})}function S(p){F[p?"unshift":"push"](()=>{o=p,t(4,o)})}function z(p){F[p?"unshift":"push"](()=>{d=p,t(1,d)})}const M=()=>{t(3,a=!1)},B=()=>{t(3,a=!0)};return r.$$set=p=>{"socket"in p&&t(8,l=p.socket)},[i,d,u,a,o,n,m,f,l,E,q,S,z,M,B]}class Ue extends le{constructor(e){super(),ne(this,e,qe,Ve,se,{socket:8})}}function Ne(r){let e,t="Disconnect",s,l,i="Create",d,u,a;return u=new Ie({props:{title:`${r[0].username}`,$$slots:{default:[ze]},$$scope:{ctx:r}}}),{c(){e=y("a"),e.textContent=t,s=H(),l=y("a"),l.textContent=i,d=H(),oe(u.$$.fragment),this.h()},l(o){e=C(o,"A",{href:!0,class:!0,"data-svelte-h":!0}),j(e)!=="svelte-1lsbkpz"&&(e.textContent=t),s=P(o),l=C(o,"A",{href:!0,class:!0,"data-svelte-h":!0}),j(l)!=="svelte-13h8egb"&&(l.textContent=i),d=P(o),ie(u.$$.fragment,o),this.h()},h(){h(e,"href","/disconnect"),h(e,"class","svelte-2gpvk8"),h(l,"href","/create"),h(l,"class","svelte-2gpvk8")},m(o,n){T(o,e,n),T(o,s,n),T(o,l,n),T(o,d,n),ue(u,o,n),a=!0},p(o,n){const m={};n&1&&(m.title=`${o[0].username}`),n&5&&(m.$$scope={dirty:n,ctx:o}),u.$set(m)},i(o){a||(V(u.$$.fragment,o),a=!0)},o(o){U(u.$$.fragment,o),a=!1},d(o){o&&(g(e),g(s),g(l),g(d)),ce(u,o)}}}function je(r){let e,t="Login";return{c(){e=y("a"),e.textContent=t,this.h()},l(s){e=C(s,"A",{href:!0,class:!0,"data-svelte-h":!0}),j(e)!=="svelte-1vxwqu1"&&(e.textContent=t),this.h()},h(){h(e,"href","/login"),h(e,"class","svelte-2gpvk8")},m(s,l){T(s,e,l)},p:R,i:R,o:R,d(s){s&&g(e)}}}function ze(r){let e,t,s;return{c(){e=y("a"),t=y("img"),this.h()},l(l){e=C(l,"A",{href:!0,class:!0});var i=O(e);t=C(i,"IMG",{src:!0,alt:!0,class:!0}),i.forEach(g),this.h()},h(){fe(t.src,s=r[0].avatar)||h(t,"src",s),h(t,"alt","Profile"),h(t,"class","svelte-2gpvk8"),h(e,"href","/profile"),h(e,"class","svelte-2gpvk8")},m(l,i){T(l,e,i),L(e,t)},p(l,i){i&1&&!fe(t.src,s=l[0].avatar)&&h(t,"src",s)},d(l){l&&g(e)}}}function me(r){let e,t;return e=new Ue({props:{socket:Ce}}),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,l){ue(e,s,l),t=!0},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){U(e.$$.fragment,s),t=!1},d(s){ce(e,s)}}}function Be(r){let e,t,s='<h1 class="svelte-2gpvk8">Persona</h1>',l,i,d='<a href="/discover" class="svelte-2gpvk8">Discover</a>',u,a,o='<input type="text" class="searchbar svelte-2gpvk8" placeholder="Search something..."/> <button class="searchbtn">Search!</button>',n,m,f,k,I,E,q,S;const z=[je,Ne],M=[];function B(c,b){return c[0]?1:0}f=B(r),k=M[f]=z[f](r);const p=r[1].default,v=_e(p,r,r[2],null);let _=r[0]&&me();return{c(){e=y("nav"),t=y("a"),t.innerHTML=s,l=H(),i=y("div"),i.innerHTML=d,u=H(),a=y("div"),a.innerHTML=o,n=H(),m=y("div"),k.c(),I=H(),v&&v.c(),E=H(),_&&_.c(),q=Q(),this.h()},l(c){e=C(c,"NAV",{class:!0});var b=O(e);t=C(b,"A",{class:!0,href:!0,"data-svelte-h":!0}),j(t)!=="svelte-1lz486n"&&(t.innerHTML=s),l=P(b),i=C(b,"DIV",{class:!0,"data-svelte-h":!0}),j(i)!=="svelte-ix3u3b"&&(i.innerHTML=d),u=P(b),a=C(b,"DIV",{class:!0,"data-svelte-h":!0}),j(a)!=="svelte-vna3yu"&&(a.innerHTML=o),n=P(b),m=C(b,"DIV",{class:!0});var A=O(m);k.l(A),A.forEach(g),b.forEach(g),I=P(c),v&&v.l(c),E=P(c),_&&_.l(c),q=Q(),this.h()},h(){h(t,"class","title svelte-2gpvk8"),h(t,"href","/"),h(i,"class","links"),h(a,"class","searching svelte-2gpvk8"),h(m,"class","profile-corner svelte-2gpvk8"),h(e,"class","navbar svelte-2gpvk8")},m(c,b){T(c,e,b),L(e,t),L(e,l),L(e,i),L(e,u),L(e,a),L(e,n),L(e,m),M[f].m(m,null),T(c,I,b),v&&v.m(c,b),T(c,E,b),_&&_.m(c,b),T(c,q,b),S=!0},p(c,[b]){let A=f;f=B(c),f===A?M[f].p(c,b):(x(),U(M[A],1,1,()=>{M[A]=null}),ee(),k=M[f],k?k.p(c,b):(k=M[f]=z[f](c),k.c()),V(k,1),k.m(m,null)),v&&v.p&&(!S||b&4)&&he(v,p,c,c[2],S?ge(p,c[2],b,null):ve(c[2]),null),c[0]?_?b&1&&V(_,1):(_=me(),_.c(),V(_,1),_.m(q.parentNode,q)):_&&(x(),U(_,1,1,()=>{_=null}),ee())},i(c){S||(V(k),V(v,c),V(_),S=!0)},o(c){U(k),U(v,c),U(_),S=!1},d(c){c&&(g(e),g(I),g(E),g(q)),M[f].d(),v&&v.d(c),_&&_.d(c)}}}function Re(r,e,t){let s;ke(r,te,d=>t(0,s=d));let{$$slots:l={},$$scope:i}=e;return Z(async()=>{let d=document.querySelectorAll("button");for(let n of d)n.addEventListener("mousedown",m=>{n.classList.add("clicked"),n.addEventListener("mouseleave",f=>{n.classList.remove("clicked")})}),n.addEventListener("mouseup",m=>{n.classList.remove("clicked"),n.addEventListener("mouseenter",f=>{n.classList.add("clicked")})});function u(n){let m=n+"=",k=decodeURIComponent(document.cookie).split(";");for(let I=0;I<k.length;I++){let E=k[I];for(;E.charAt(0)==" ";)E=E.substring(1);if(E.indexOf(m)==0)return E.substring(m.length,E.length)}return""}let a=document.querySelector(".searchbar");document.querySelector(".searchbtn").addEventListener("click",n=>{window.location.href=`/search?q=${encodeURIComponent(a.value)}`}),u("token")&&Ce.emit("login",u("token"),n=>{te.set(n)})}),r.$$set=d=>{"$$scope"in d&&t(2,i=d.$$scope)},[s,l,i]}class Qe extends le{constructor(e){super(),ne(this,e,Re,Be,se,{})}}export{Qe as component,Ke as universal};
